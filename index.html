<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="site.title">RUC Portal - Access Yanhekt Resources</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" type="image/png" href="img/logo.png">
    <link rel="apple-touch-icon" href="img/logo.png">
    <link rel="preload" href="img/logo.png" as="image">
    <link rel="preload" href="img/seal.png" as="image">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="index.html" class="logo-link">
                        <img src="img/logo.png" alt="RUC Logo" class="logo">
                        <div class="logo-text">
                            <h1><span class="full-name" data-i18n="nav.title">Razzakov University College</span></h1>
                            <p><span class="subtitle" data-i18n="nav.subtitle">Yanhekt Student Portal</span></p>
                        </div>
                    </a>
                </div>
                <div class="nav-right">
                    <div class="language-switcher">
                        <a href="#" class="lang-btn" data-lang="en">EN</a>
                        <a href="#" class="lang-btn" data-lang="zh">中文</a>
                    </div>
                </div>
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </button>
            </div>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 data-i18n="hero.title">RUC Student Portal</h1>
                    <p class="hero-subtitle" data-i18n="hero.subtitle">Access live streams from Yanhekt and get real-time slides</p>
                    <p class="hero-motto" data-i18n="hero.motto">By using our services, you agree to our terms and conditions.</p>
                </div>
                <div class="hero-seal">
                    <img src="img/seal.png" alt="University Seal" loading="lazy" />
                </div>
            </div>
        </section>

        <!-- Instructions Section -->
        <section class="instructions-section">
            <div class="container">
                <div class="instructions-header">
                    <h2 data-i18n="instructions.title">How to Get Started</h2>
                    <button class="toggle-instructions" id="toggleInstructions">
                        <span data-i18n="instructions.toggle">Show Instructions</span>
                        <span class="arrow">▼</span>
                    </button>
                </div>
                <div class="instructions-content" id="instructionsContent">
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3 data-i18n="instructions.step1.title">Get Your Token from Yanhekt</h3>
                            <p data-i18n="instructions.step1.desc">If you trust this service, you can log in directly using your BIT SSO account and password. Or, you can first visit Yanhekt and log in to your account, then use our bookmark tool to extract your access token. This operation only needs to be done once while the token is valid.</p>
                            <div class="bookmark-tool">
                                <h4 data-i18n="instructions.bookmark.title">Bookmark Tool</h4>
                                <p data-i18n="instructions.bookmark.instruction">Drag the button below to your bookmarks bar, then click it on the Yanhekt website:</p>
                                <div class="bookmark-container">
                                    <a href="javascript:void(0)" 
                                          class="bookmark-tool-btn" 
                                          data-i18n="instructions.bookmark.button">Get Yanhekt Token</a>
                                </div>
                                <p class="note" data-i18n="instructions.bookmark.note">Note: On desktop browsers, press Ctrl/Cmd+Shift+B to show the bookmarks bar; on iOS Safari, tap the "book" icon at the bottom of the interface to enter the bookmarks bar, then long-press the button above and drag it here.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3 data-i18n="instructions.step2.title">Enter Your Token</h3>
                            <p data-i18n="instructions.step2.desc">Paste the token you copied from Yanhekt into the input field below. We do not store your account, password, or access token on the server.</p>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3 data-i18n="instructions.step3.title">Browse Live Streams</h3>
                            <p data-i18n="instructions.step3.desc">To view the courses you have registered for this semester, please check your personal live stream list; to view all live stream courses currently available across the school, please switch to the public live stream list. You can also enter keywords to search for courses that you want to watch.</p>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3 data-i18n="instructions.step4.title">Enable automatic slide extraction</h3>
                            <p data-i18n="instructions.step4.desc">When choosing to watch a screen recording, you can enable the automatic slide extraction feature. When enabling this feature on a mobile device, keep the browser tab active and in the foreground, and avoid entering full-screen or mini-window playback mode. Known limitations: On iOS Safari, switching apps, locking the screen, or entering full-screen or mini-window playback mode may cause slide extraction to stop.</p>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h3 data-i18n="instructions.step5.title">Manage Your Saved Slides</h3>
                            <p data-i18n="instructions.step5.desc">Extracted slides will be saved locally in your browser. You can click "View Saved Slides" to view and manage your stored slides; should an index error occur in the local database, you may attempt to rectify it by using the "Clear All Data" function.</p>
                        </div>
                    </div>
                    
                    <div class="instruction-step">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <h3 data-i18n="instructions.step6.title">Download Recorded Videos</h3>
                            <p><span data-i18n="instructions.step6.desc">Want to download recorded course videos from Yanhekt? Use our Electron version downloader:</span> <a href="https://github.com/bit-admin/Yanhekt-downloader-electron" target="_blank" rel="noopener noreferrer">Yanhekt Downloader</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Token Input Section -->
        <section class="token-section">
            <div class="container">
                <div class="token-card">
                    <h2 data-i18n="token.title">Access Token</h2>
                    <div class="token-input-group">
                        <input type="password" 
                               id="tokenInput" 
                               placeholder="Enter your Yanhekt token..."
                               data-i18n-placeholder="token.placeholder">
                        <button type="button" class="toggle-visibility" id="toggleTokenVisibility">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.45703 12C3.73128 7.94291 7.52159 5 11.9992 5C16.4769 5 20.2672 7.94291 21.5414 12C20.2672 16.0571 16.4769 19 11.9992 19C7.52159 19 3.73128 16.0571 2.45703 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M11.9992 15C13.6561 15 14.9992 13.6569 14.9992 12C14.9992 10.3431 13.6561 9 11.9992 9C10.342 9 8.99902 10.3431 8.99902 12C8.99902 13.6569 10.342 15 11.9992 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                    </div>
                    <div class="token-actions">
                        <button class="btn btn-secondary" id="loginBtn" data-i18n="token.login">Login with Account</button>
                        <button class="btn btn-primary" id="saveTokenBtn" data-i18n="token.save">Save Token</button>
                        <button class="btn btn-secondary" id="clearTokenBtn" data-i18n="token.clear">Clear Token</button>
                    </div>
                    <div class="token-status" id="tokenStatus"></div>
                </div>
            </div>
        </section>

        <!-- Live Stream Lists Section -->
        <section class="streams-section">
            <div class="container">
                <div class="streams-header">
                    <h2 data-i18n="streams.title">Live Streams</h2>
                    <div class="stream-controls">
                        <a href="slides.html" class="btn btn-outline slides-manager-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5 3H19C20.1 3 21 3.9 21 5V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V5C3 3.9 3.9 3 5 3ZM5 19H19V7H5V19Z" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 10H16" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 14H13" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span data-i18n="nav.slides">View Saved Slides</span>
                        </a>
                        <button class="btn btn-primary" id="getPersonalStreamsBtn" data-i18n="streams.personal">Personal Streams</button>
                        <button class="btn btn-secondary" id="getPublicStreamsBtn" data-i18n="streams.public">Public Streams</button>

                        <!-- Search Input -->
                        <div class="search-input-container">
                            <div class="search-input-wrapper">
                                <input type="text"
                                       id="keywordSearchInput"
                                       class="search-input"
                                       placeholder="Enter keyword to search courses..."
                                       data-i18n-placeholder="search.keyword_placeholder">
                                <button type="button"
                                        id="searchBtn"
                                        class="search-button"
                                        data-i18n-title="search.button">
                                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                                        <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Bar (hidden by default, shown in debug mode) -->
                <div class="filter-bar debug-only" id="filterBar" style="display: none;">
                    <div class="filter-controls">
                        <div class="filter-input-group">
                            <div class="filter-enable">
                                <input type="checkbox" id="enableFilterCheckbox">
                                <label for="enableFilterCheckbox" data-i18n="filter.enable">Enable Filter</label>
                            </div>
                            <input type="text"
                                   id="titleFilterInput"
                                   placeholder="Enter course title to search..."
                                   data-i18n-placeholder="filter.title_placeholder"
                                   disabled>
                            <select id="searchRangeSelect" disabled>
                                <option value="16" data-i18n="filter.search_range.16">Search in first 16</option>
                                <option value="32" data-i18n="filter.search_range.32">Search in first 32</option>
                                <option value="64" data-i18n="filter.search_range.64">Search in first 64</option>
                                <option value="128" data-i18n="filter.search_range.128">Search in first 128</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="loading-indicator" id="loadingIndicator" style="display: none;">
                    <div class="spinner"></div>
                    <span data-i18n="loading">Loading...</span>
                </div>

                <div class="streams-grid" id="streamsGrid">
                    <!-- Stream cards will be populated here -->
                </div>
                
                <div class="pagination" id="pagination" style="display: none;">
                    <button class="btn btn-outline" id="prevPageBtn" data-i18n="pagination.prev">Previous</button>
                    <span class="page-info" id="pageInfo">Page 1 of 1</span>
                    <button class="btn btn-outline" id="nextPageBtn" data-i18n="pagination.next">Next</button>
                </div>
                
                <div class="no-streams-message" id="noStreamsMessage" style="display: none;">
                    <h3 data-i18n="streams.no_streams.title">No streams found</h3>
                    <p data-i18n="streams.no_streams.desc">Please check your token and try again.</p>
                </div>

                <!-- Debug Panel -->
                <div class="debug-panel" id="debugPanel" style="display: none;">
                    <div class="debug-panel-header">
                        <h3 data-i18n="debug.title">Debug Mode</h3>
                        <button class="btn btn-outline btn-sm" id="closeDebugPanel" data-i18n="debug.close">Close</button>
                    </div>
                    <div class="debug-panel-content">
                        <div class="debug-section">
                            <h4 data-i18n="debug.m3u8.title">M3U8 Stream URL</h4>
                            <p data-i18n="debug.m3u8.desc">Enter a direct m3u8 stream URL for testing</p>
                            <div class="input-group">
                                <input type="url" id="debugM3u8Input" placeholder="https://example.com/stream.m3u8" data-i18n-placeholder="debug.m3u8.placeholder">
                                <button class="btn btn-primary" id="debugM3u8Btn" data-i18n="debug.m3u8.button">Test M3U8</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#" id="termsLink" data-i18n="footer.terms">Terms and Conditions</a>
                    <a href="https://yanhekt.cn" target="_blank" data-i18n="footer.yanhekt">Visit Yanhekt</a>
                    <a href="https://yanhe.bitech.edu.kg/" target="_blank" data-i18n="footer.old_version">Old Version</a>
                    <a href="https://github.com/bit-admin/Yanhekt-AutoSlides" target="_blank" data-i18n="footer.github">GitHub</a>
                </div>
                <div class="footer-copyright">
                    <p data-i18n="footer.copyright">© 2025 Razzakov University College. | Yanhekt™ is a trademark of its rights holder. | We respect the copyright and other intellectual property rights of third parties.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Terms Modal -->
    <div class="modal" id="termsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="terms.title">Terms and Conditions</h2>
                <button class="modal-close" id="closeTermsModal">&times;</button>
            </div>
            <div class="modal-body" id="termsContent">
                <!-- Terms content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="login.title">Login with Account</h2>
                <button class="modal-close" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="usernameInput" data-i18n="login.username">Student ID</label>
                        <input type="text" 
                               id="usernameInput" 
                               placeholder="Enter your student ID"
                               data-i18n-placeholder="login.username_placeholder"
                               required>
                    </div>
                    <div class="form-group">
                        <label for="passwordInput" data-i18n="login.password">Password</label>
                        <input type="password" 
                               id="passwordInput" 
                               placeholder="Enter your password"
                               data-i18n-placeholder="login.password_placeholder"
                               required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelLoginBtn" data-i18n="login.cancel">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="submitLoginBtn" data-i18n="login.submit">Login</button>
                    </div>
                    <div class="login-status" id="loginStatus"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/token.js"></script>
    <script src="js/api.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/bookmark-generator.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
